<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Nikagenyx</title>
  <link href="https://fonts.googleapis.com/css2?family=Questrial&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Questrial', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-900 text-white">

<script>
  const session = localStorage.getItem("emp_session");
  if (!session) {
    window.location.href = "employee_portal.html";
  } else {
    const user = JSON.parse(session);
    if (user.role !== "admin") {
      window.location.href = "employee_dashboard.html";
    }
  }
</script>

<nav class="w-full bg-gray-800 px-6 py-4 flex items-center justify-between">
  <a href="index.html" class="text-2xl font-bold text-white">Nikagenyx</a>
  <ul class="flex gap-6 text-sm">
    <li><a href="employee_portal.html" class="hover:text-purple-400">Employee Portal</a></li>
    <li><a href="register_employee.html" class="hover:text-purple-400">Register</a></li>
    <li><button onclick="logout()" class="bg-red-600 px-4 py-1 rounded">Logout</button></li>
  </ul>
</nav>

<main class="p-8 max-w-5xl mx-auto">
  <h1 class="text-3xl font-bold mb-6">Admin Dashboard</h1>
  <p class="text-gray-300">Welcome, Admin. Below is the list of registered employees.</p>

  <div class="mt-8">
    <h2 class="text-xl font-semibold mb-4">Employee Records</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-gray-800 border border-gray-600 text-sm rounded-lg overflow-hidden">
        <thead>
          <tr class="bg-gray-700">
            <th class="py-2 px-4 text-left border-r">ID</th>
            <th class="py-2 px-4 text-left border-r">Name</th>
            <th class="py-2 px-4 text-left border-r">Phone</th>
            <th class="py-2 px-4 text-left border-r">DOB</th>
            <th class="py-2 px-4 text-left border-r">Role</th>
            <th class="py-2 px-4 text-left">Department</th>
          </tr>
        </thead>
        <tbody id="employeeTableBody">
          <tr><td colspan="6" class="text-center py-4">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</main>

<footer class="bg-gray-800 text-gray-500 text-center py-6 text-sm mt-20">
  &copy; 2025 Nikagenyx Vision Tech Private Limited. All rights reserved.
</footer>

<script>
  function logout() {
    localStorage.removeItem("emp_session");
    window.location.href = "employee_portal.html";
  }

  async function loadEmployees() {
    const tbody = document.getElementById("employeeTableBody");
    try {
      const res = await fetch("/.netlify/functions/get_employees");
      const data = await res.json();

      if (!data.employees || data.employees.length === 0) {
        tbody.innerHTML = "<tr><td colspan='6' class='text-center py-4'>No employees found.</td></tr>";
        return;
      }

      tbody.innerHTML = "";
      data.employees.forEach(emp => {
        const row = `
          <tr class="border-t border-gray-700">
            <td class="py-2 px-4 border-r">${emp.emp_id}</td>
            <td class="py-2 px-4 border-r">${emp.name}</td>
            <td class="py-2 px-4 border-r">${emp.phone || '-'}</td>
            <td class="py-2 px-4 border-r">${emp.dob || '-'}</td>
            <td class="py-2 px-4 border-r">${emp.role}</td>
            <td class="py-2 px-4">${emp.department || '-'}</td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    } catch (err) {
      tbody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-red-400">Error loading data</td></tr>`;
      console.error("Error fetching employees:", err);
    }
  }

  loadEmployees();
</script>

</body>
</html>
